<!DOCTYPE html>
<html lang="en-US">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>用Nodejs连接MySQL | 粉丝日志</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="pingback" href="http://blog.fens.me/xmlrpc.php" />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="粉丝日志 &raquo; Feed" href="http://blog.fens.me/feed/" />
<link rel="alternate" type="application/rss+xml" title="粉丝日志 &raquo; Comments Feed" href="http://blog.fens.me/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="粉丝日志 &raquo; 用Nodejs连接MySQL Comments Feed" href="http://blog.fens.me/nodejs-mysql-intro/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.2.1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.2.1\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/blog.fens.me\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.7.4"}};
			!function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),!(j.toDataURL().length<3e3)&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57331,65039,8205,55356,57096),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57331,55356,57096),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55357,56425,55356,57341,8205,55357,56507),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55357,56425,55356,57341,55357,56507),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='default-css'  href='http://blog.fens.me/wp-content/themes/silesia/style.css' type='text/css' media='all' />
<!--[if IE 7]>
<link rel='stylesheet' id='silesia-ie7-css'  href='http://blog.fens.me/wp-content/themes/silesia/ie7.css' type='text/css' media='all' />
<![endif]-->
<!--[if IE 6]>
<link rel='stylesheet' id='silesia-ie6-css'  href='http://blog.fens.me/wp-content/themes/silesia/ie6.css' type='text/css' media='all' />
<![endif]-->
<script type='text/javascript' src='http://blog.fens.me/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='http://blog.fens.me/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript' src='http://blog.fens.me/wp-content/themes/silesia/js/jquery.cycle.all.min.js'></script>
<script type='text/javascript' src='http://blog.fens.me/wp-content/themes/silesia/js/load.js'></script>
<link rel='https://api.w.org/' href='http://blog.fens.me/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://blog.fens.me/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://blog.fens.me/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='ngTable动态更新的三种方式' href='http://blog.fens.me/angularjs-ngtable-update/' />
<link rel='next' title='Nodejs异步流程控制Async' href='http://blog.fens.me/nodejs-async/' />
<meta name="generator" content="WordPress 4.7.4" />
<link rel="canonical" href="http://blog.fens.me/nodejs-mysql-intro/" />
<link rel='shortlink' href='http://blog.fens.me/?p=2343' />
<link rel="alternate" type="application/json+oembed" href="http://blog.fens.me/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fblog.fens.me%2Fnodejs-mysql-intro%2F" />
<link rel="alternate" type="text/xml+oembed" href="http://blog.fens.me/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fblog.fens.me%2Fnodejs-mysql-intro%2F&#038;format=xml" />
<meta name="template" content="silesia 1.0.6" />
<meta name="generator" content="NattyWP Framework Version 2.1.5" />
<meta name="keywords" content="nodejs,mysql,node-mysql,连接池,断线重连" />
<meta name="description" content="跨界的IT博客，核心IT技术包括：Hadoop, R, RHadoop, Nodejs, AngularJS, KVM, NoSQL, IT金融" />
<link href="http://blog.fens.me/wp-content/uploads/2013/05/favicon.ico" rel="shortcut icon" type="image/x-icon" />
<link rel="stylesheet" type="text/css" href="http://blog.fens.me/wp-content/themes/silesia/functions/css/shortcodes.css" media="screen" /><script type="text/javascript" src="http://blog.fens.me/wp-content/themes/silesia/functions/js/shortcode.js"></script><style type="text/css">
	#header {
		background-color: #F7F7F7;
	}
	#main-nav, #main-nav a#control, #link-sidebar h2 {
		color: #30353A;
	}
	#header .tagline {
		color: #BBBBBB;
	}
	#main-nav {
		background-color: #527F8D;
	}
	#main-nav, #main-nav a#control, #link-sidebar h2 {
		color: #ffffff;
	}
	#link-sidebar a, #main-nav a#control:hover {
		color: #D8F1FA;
	}
	#link-sidebar ul li.widget a:hover {
		color: #ffffff;
	}
	.hentry h2, .hentry h2 a, .singlepage .post h2, .singlepage .page.comments h2 {
		color: #434343;
	}
	.p-cont .entry, .singlepage .entry {
		color: #4D4D4F;
	}
	.post a, .page.comments a {
		color: #0E73B8;
	}
	.post a:hover, .page.comments a:hover, .hentry h2 a:hover {
		color: #ff0505;
	}
	#sidebar h2 {
		color: #4D4D4F;
	}
	#sidebar {
		color: #555555;
	}
	#sidebar a {
		color: #0E73B8;
	}
	#sidebar a:hover {
		color: #ff0505;
	}
</style><style type="text/css">
    #header .triangle {border-left: 7px solid #527F8D;}
  </style><!--[if IE 6]>
    <script type="text/javascript" src="http://blog.fens.me/wp-content/themes/silesia/js/ie6/warning.js"></script>
    <script type="text/javascript" charset="utf-8">/*<![CDATA[*/window.onload=function(){e("http://blog.fens.me/wp-content/themes/silesia/js/ie6/")}/*]]>*/</script>
<![endif]-->		<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
		<style type="text/css" id="custom-background-css">
body.custom-background { background-color: #ffffff; }
</style>
</head>

<body class="post-template-default single single-post postid-2343 single-format-standard custom-background">
<div id="main-nav">
  <div id="link-sidebar">
    <ul>
                      <li class="widget png_scale" id="widget_categories">
          <h2 class="blocktitle"><span>Categories</span></h2>	
          <ul>
              	<li class="cat-item cat-item-9"><a href="http://blog.fens.me/category/datagurucn/" >Dataguru作业</a>
</li>
	<li class="cat-item cat-item-1"><a href="http://blog.fens.me/category/hadoop-action/" >Hadoop实践</a>
</li>
	<li class="cat-item cat-item-65"><a href="http://blog.fens.me/category/it%e7%9b%b8%e5%85%b3%e7%9f%a5%e8%af%86/" >IT相关知识</a>
</li>
	<li class="cat-item cat-item-55"><a href="http://blog.fens.me/category/javascript%e8%af%ad%e8%a8%80%e5%ae%9e%e8%b7%b5/" >Javascript语言实践</a>
</li>
	<li class="cat-item cat-item-3"><a href="http://blog.fens.me/category/java-lang/" >JAVA语言实践</a>
</li>
	<li class="cat-item cat-item-8"><a href="http://blog.fens.me/category/r-lang/" >R语言实践</a>
</li>
	<li class="cat-item cat-item-217"><a href="http://blog.fens.me/category/seo%e4%bc%98%e5%8c%96/" >SEO优化</a>
</li>
	<li class="cat-item cat-item-356"><a href="http://blog.fens.me/category/%e5%85%b6%e4%bb%96%e8%af%ad%e8%a8%80/" >其他语言</a>
</li>
	<li class="cat-item cat-item-774"><a href="http://blog.fens.me/category/%e5%88%9b%e4%b8%9a/" >创业</a>
</li>
	<li class="cat-item cat-item-233"><a href="http://blog.fens.me/category/%e5%8f%af%e8%a7%86%e5%8c%96%e6%8a%80%e6%9c%af/" >可视化技术</a>
</li>
	<li class="cat-item cat-item-20"><a href="http://blog.fens.me/category/%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f/" >操作系统</a>
</li>
	<li class="cat-item cat-item-29"><a href="http://blog.fens.me/category/%e6%95%b0%e6%8d%ae%e5%ba%93/" >数据库</a>
</li>
	<li class="cat-item cat-item-30"><a href="http://blog.fens.me/category/%e6%95%b0%e6%8d%ae%e6%8c%96%e6%8e%98/" >数据挖掘</a>
</li>
	<li class="cat-item cat-item-10"><a href="http://blog.fens.me/category/%e6%99%92%e7%b2%89%e4%b8%9d/" >晒粉丝</a>
</li>
	<li class="cat-item cat-item-19"><a href="http://blog.fens.me/category/%e6%9e%b6%e6%9e%84%e8%ae%be%e8%ae%a1/" >架构设计</a>
</li>
	<li class="cat-item cat-item-113"><a href="http://blog.fens.me/category/%e6%b4%bb%e5%8a%a8%e8%81%9a%e4%bc%9a/" >活动聚会</a>
</li>
	<li class="cat-item cat-item-598"><a href="http://blog.fens.me/category/%e6%b8%b8%e6%88%8f/" >游戏</a>
</li>
	<li class="cat-item cat-item-24"><a href="http://blog.fens.me/category/%e7%a8%8b%e5%ba%8f%e7%ae%97%e6%b3%95/" >程序算法</a>
</li>
	<li class="cat-item cat-item-117"><a href="http://blog.fens.me/category/%e7%bd%91%e7%bb%9c%e6%8a%80%e6%9c%af/" >网络技术</a>
</li>
	<li class="cat-item cat-item-76"><a href="http://blog.fens.me/category/%e8%99%9a%e6%8b%9f%e5%8c%96%e5%ae%9e%e8%b7%b5/" >虚拟化实践</a>
</li>
	<li class="cat-item cat-item-184"><a href="http://blog.fens.me/category/%e9%87%91%e8%9e%8d/" >金融</a>
</li>
	<li class="cat-item cat-item-32"><a href="http://blog.fens.me/category/%e9%9d%a2%e8%af%95/" >面试</a>
</li>
	<li class="cat-item cat-item-44"><a href="http://blog.fens.me/category/%e9%bb%91%e5%ae%a2%e6%94%bb%e9%98%b2/" >黑客攻防</a>
</li>
          </ul>		
        </li>
                <li id="twitterWidget" class="widget png_scale">	
          <div id="twitter">
            <h2 class="blocktitle"><span>Twitter Updates</span></h2>		<ul id="twitter_update_list"><li></li></ul>
            <!--<script type="text/javascript" src="http://twitter.com/javascripts/blogger.js"></script>-->
            <!--<script type="text/javascript" src="http://twitter.com/statuses/user_timeline/nattywp.json?callback=twitterCallback2&amp;count=1"></script>-->
            <div class="dasheddivider"></div>
            <p align="right"><a href="http://www.twitter.com/nattywp/" class="rightlink png_crop">Follow us on Twitter</a></p>
        </div>
        </li>   
           
    </ul>
  </div>
  <a id="control" href="#">+</a>
</div>

<div id="main-wrapper">
<div id="header">
  <div class="wrapper">
    <div class="triangle"></div>
    <div class="logo-block">
    <div class="logo">
    <ul><li><a class="logo-title shadowed" href="http://blog.fens.me" rel="home" title="粉丝日志">粉丝日志</a></li></ul> 
    </div>
  <div class="tagline">跨界的IT博客|Hadoop家族, R, RHadoop, Nodejs, AngularJS, NoSQL, IT金融</div></div>
  
    <div class="clear"></div>
  </div>
</div>

<div id="cnt" class="wrapper">
  <div class="top">
    <ul id="crumbs"><li class="first"><a href="http://blog.fens.me" id="home-img"></a></li><li><a href="http://blog.fens.me/category/javascript%e8%af%ad%e8%a8%80%e5%ae%9e%e8%b7%b5/">Javascript语言实践</a> &raquo; </li><li>用Nodejs连接MySQL</li></ul><div style="float:right;margin-right:10px;font-size:14px;"><ul style="list-style-type: none;"><li style="list-style-type: none;float: left;line-height: 24px;margin: 0 7px;"><a href="http://www.fens.me/" target="_blank">@晒粉丝</a></li><li style="list-style-type: none;float: left;line-height: 24px;margin: 0 7px;"><a href="http://apps.weibo.com/chinaweatherapp" target="_blank">@每日中国天气</a></li></ul></div>    <div class="clear"></div>            
  </div> <!-- END top -->


<!-- END Header --><div class="narrowcolumn singlepage">
              <div class="post-2343 post type-post status-publish format-standard hentry category-javascript category-29 tag-mysql tag-node-mysql tag-nodejs tag-283 tag-282">
         <div class="post-meta">
          <a href="http://blog.fens.me/nodejs-mysql-intro/" title="用Nodejs连接MySQL" class="ms"></a>
          <h5>Posted:</h5>
          <span class="date">Sep 11, 2013</span>
          <h5>Tags:</h5><div class="tags"><a href="http://blog.fens.me/tag/mysql/" rel="tag">MySQL</a><a href="http://blog.fens.me/tag/node-mysql/" rel="tag">node-mysql</a><a href="http://blog.fens.me/tag/nodejs/" rel="tag">nodejs</a><a href="http://blog.fens.me/tag/%e6%96%ad%e7%ba%bf%e9%87%8d%e8%bf%9e/" rel="tag">断线重连</a><a href="http://blog.fens.me/tag/%e8%bf%9e%e6%8e%a5%e6%b1%a0/" rel="tag">连接池</a></div>          <h5>Comments:</h5>
          <span class="comment"><a href="http://blog.fens.me/nodejs-mysql-intro/#comments"><span class="dsq-postid" data-dsqidentifier="2343 http://blog.fens.me/?p=2343">66 Comments</span></a></span>
                   </div>
         
         <div class="p-cont">
            <h2>用Nodejs连接MySQL</h2>
            <div class="entry">
                            <p><a title="从零开始nodejs系列文章" href="http://blog.fens.me/series-nodejs/" target="_blank">从零开始nodejs系列文章</a>，将介绍如何利Javascript做为服务端脚本，通过Nodejs框架web开发。Nodejs框架是基于V8的引擎，是目前速度最快的Javascript引擎。chrome浏览器就基于V8，同时打开20-30个网页都很流畅。Nodejs标准的web开发框架Express，可以帮助我们迅速建立web站点，比起PHP的开发效率更高，而且学习曲线更低。非常适合小型网站，个性化网站，我们自己的Geek网站！！</p>
<p><strong>关于作者</strong></p>
<ul>
<li>张丹(Conan), 程序员Java,R,PHP,Javascript</li>
<li>weibo：@Conan_Z</li>
<li>blog: <a title="粉丝日志|跨界的IT博客" href="http://blog.fens.me/" target="_blank">http://blog.fens.me</a></li>
<li>email: bsspirit@gmail.com</li>
</ul>
<p><strong>转载请注明出处：</strong><br />
<a title="用Nodejs连接MySQL" href="http://blog.fens.me/nodejs-mysql-intro/" target="_blank">http://blog.fens.me/nodejs-mysql-intro/</a></p>
<p><a href="http://blog.fens.me/wp-content/uploads/2013/09/nodejs-mysql.png"><img src="http://blog.fens.me/wp-content/uploads/2013/09/nodejs-mysql.png" alt="nodejs-mysql" width="600" height="400" class="alignnone size-full wp-image-2369" /></a></p>
<p><strong>前言</strong></p>
<p>MySQL是一款常用的开源数据库产品，通常也是免费数据库的首选。查了一下NPM列表，发现Nodejs有13库可以访问MySQL，felixge/node-mysql似乎是最受关注项目，我也决定尝试用一下。</p>
<p>要注意名字，&#8221;felixge/node-mysql&#8221;非&#8221;node-mysql&#8221;，安装部分会介绍这个小插曲！</p>
<p><strong>目录</strong></p>
<ol>
<li>node-mysql介绍</li>
<li>建立MySQL测试库</li>
<li>node-mysql安装</li>
<li>node-mysql使用</li>
</ol>
<h2>1. node-mysql介绍</h2>
<p>felixge/node-mysql是一个纯nodejs的用javascript实现的一个MySQL客户端程序。felixge/node-mysql封装了Nodejs对MySQL的基本操作，100% MIT公共许可证。</p>
<p>项目地址：https://github.com/felixge/node-mysql</p>
<h2>2. 建立MySQL测试库</h2>
<p>本地创建MySQL测试库：nodejs</p>
<pre><code>
~ mysql -uroot -p
mysql&gt; CREATE DATABASE nodejs;
mysql&gt; SHOW DATABASES;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| nodejs             |
| performance_schema |
+--------------------+
4 rows in set (0.00 sec)

mysql&gt; GRANT ALL ON nodejs.* to nodejs@'%' IDENTIFIED BY 'nodejs';
mysql&gt; GRANT ALL ON nodejs.* to nodejs@localhost IDENTIFIED BY 'nodejs';
</code></pre>
<p>重新登陆MySQL</p>
<pre><code>
C:\Users\Administrator&gt;mysql -unodejs -p
Enter password: ******

mysql&gt; SHOW DATABASES;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| nodejs             |
| test               |
+--------------------+
3 rows in set (0.00 sec)

mysql&gt; USE nodejs
Database changed
</code></pre>
<p>新建一个user表</p>
<pre><code>
CREATE TABLE t_user(
id INT PRIMARY KEY AUTO_INCREMENT,
name VARCHAR(16) NOT NULL ,
create_date TIMESTAMP NULL DEFAULT now()
)ENGINE=InnoDB DEFAULT CHARSET=utf8;
CREATE UNIQUE INDEX t_quiz_IDX_0 on t_user(name);

mysql&gt; SHOW TABLES;
+------------------+
| Tables_in_nodejs |
+------------------+
| t_user           |
+------------------+
1 row in set (0.04 sec)
</code></pre>
<h2>3. node-mysql安装</h2>
<p><strong>我的系统环境</strong></p>
<ul>
<li>win7 64bit</li>
<li>Nodejs:v0.10.5</li>
<li>Npm:1.2.19</li>
<li>MySQL:Server version: 5.6.11 MySQL Community Server (GPL)</li>
</ul>
<p><strong>创建工程:nodejs-node-mysql</strong></p>
<pre><code>~ D:\workspace\javascript&gt;mkdir nodejs-node-mysql
~ D:\workspace\javascript&gt;cd nodejs-node-mysql
~ D:\workspace\javascript\nodejs-node-mysql&gt;npm install node-mysql
node-mysql@0.2.0 node_modules\node-mysql
├── better-js-class@0.1.2
├── cps@0.1.7
├── underscore@1.5.2
└── mysql@2.0.0-alpha9 (require-all@0.0.3, bignumber.js@1.0.1)
</code></pre>
<p><strong>这里有一个小插曲</strong></p>
<p>安装“node-mysql”后，打开package.json文件发现，这个项目地址是</p>
<pre><code>https://github.com/redblaze/node-mysql.git</code></pre>
<p>从依赖关系可以看到，它依赖于mysql库，是对felixge/node-mysql的封装。</p>
<p><a href="http://blog.fens.me/wp-content/uploads/2013/09/node-mysql1.png"><img class="alignnone size-full wp-image-2350" alt="node-mysql1" src="http://blog.fens.me/wp-content/uploads/2013/09/node-mysql1.png" width="999" height="213" /></a></p>
<p>由于这个项目star是0，fork也是0. 所以，我也不准备花时间测试了，重新安装felixge/node-mysql的包。</p>
<p><strong>重新安装node-mysql</strong></p>
<pre><code>~ D:\workspace\javascript\nodejs-node-mysql&gt;rm -rf node_modules
~ D:\workspace\javascript\nodejs-node-mysql&gt;npm install mysql@2.0.0-alpha9
npm http GET https://registry.npmjs.org/mysql/2.0.0-alpha9
npm http 200 https://registry.npmjs.org/mysql/2.0.0-alpha9
npm http GET https://registry.npmjs.org/mysql/-/mysql-2.0.0-alpha9.tgz
npm http 200 https://registry.npmjs.org/mysql/-/mysql-2.0.0-alpha9.tgz
npm http GET https://registry.npmjs.org/require-all/0.0.3
npm http GET https://registry.npmjs.org/bignumber.js/1.0.1
npm http 304 https://registry.npmjs.org/require-all/0.0.3
npm http 304 https://registry.npmjs.org/bignumber.js/1.0.1
mysql@2.0.0-alpha9 node_modules\mysql
├── require-all@0.0.3
└── bignumber.js@1.0.1
</code></pre>
<p>这回就对了，继续下面的开发！</p>
<p>创建node程序启动文件：app.js</p>
<p><strong>第一个测试</strong></p>
<pre><code>~ vi app.js

var mysql = require('mysql');
var conn = mysql.createConnection({
    host: 'localhost',
    user: 'nodejs',
    password: 'nodejs',
    database:'nodejs',
    port: 3306
});
conn.connect();
conn.query('SELECT 1 + 1 AS solution', function(err, rows, fields) {
    if (err) throw err;
    console.log('The solution is: ', rows[0].solution);
});
conn.end();
</code></pre>
<p><strong>运行node</strong></p>
<pre><code>~ D:\workspace\javascript\nodejs-node-mysql&gt;node app.js
The solution is:  2
</code></pre>
<p>这样我们就让Nodejs连接上了MySQL。</p>
<h2>4. node-mysql使用</h2>
<p>下面我们要对node-mysql的API进行常用的测试。</p>
<ul>
<li>表新删改查</li>
<li><span style="font-size: 13px; line-height: 19px;">连接池配置</span></li>
<li>MySQL断线重连</li>
<li>连接池超时测试</li>
</ul>
<p><strong>1). 表新删改查</strong><br />
修改app.js</p>
<pre><code>
~ vi app.js

var mysql = require('mysql');
var conn = mysql.createConnection({
    host: 'localhost',
    user: 'nodejs',
    password: 'nodejs',
    database: 'nodejs',
    port: 3306
});
conn.connect();

var insertSQL = 'insert into t_user(name) values("conan"),("fens.me")';
var selectSQL = 'select * from t_user limit 10';
var deleteSQL = 'delete from t_user';
var updateSQL = 'update t_user set name="conan update"  where name="conan"';

//delete
conn.query(deleteSQL, function (err0, res0) {
    if (err0) console.log(err0);
    console.log("DELETE Return ==&gt; ");
    console.log(res0);

    //insert
    conn.query(insertSQL, function (err1, res1) {
        if (err1) console.log(err1);
        console.log("INSERT Return ==&gt; ");
        console.log(res1);

        //query
        conn.query(selectSQL, function (err2, rows) {
            if (err2) console.log(err2);

            console.log("SELECT ==&gt; ");
            for (var i in rows) {
                console.log(rows[i]);
            }

            //update
            conn.query(updateSQL, function (err3, res3) {
                if (err3) console.log(err3);
                console.log("UPDATE Return ==&gt; ");
                console.log(res3);

                //query
                conn.query(selectSQL, function (err4, rows2) {
                    if (err4) console.log(err4);

                    console.log("SELECT ==&gt; ");
                    for (var i in rows2) {
                        console.log(rows2[i]);
                    }
                });
            });
        });
    });
});

//conn.end();
</code></pre>
<p>控制台输出：</p>
<pre><code>D:\workspace\javascript\nodejs-node-mysql&gt;node app.js
DELETE Return ==&gt;
{ fieldCount: 0,
  affectedRows: 2,
  insertId: 0,
  serverStatus: 34,
  warningCount: 0,
  message: '',
  protocol41: true,
  changedRows: 0 }
INSERT Return ==&gt;
{ fieldCount: 0,
  affectedRows: 2,
  insertId: 33,
  serverStatus: 2,
  warningCount: 0,
  message: '&amp;Records: 2  Duplicates: 0  Warnings: 0',
  protocol41: true,
  changedRows: 0 }
SELECT ==&gt;
{ id: 33,
  name: 'conan',
  create_date: Wed Sep 11 2013 12:09:15 GMT+0800 (中国标准时间) }
{ id: 34,
  name: 'fens.me',
  create_date: Wed Sep 11 2013 12:09:15 GMT+0800 (中国标准时间) }
UPDATE Return ==&gt;
{ fieldCount: 0,
  affectedRows: 1,
  insertId: 0,
  serverStatus: 2,
  warningCount: 0,
  message: '(Rows matched: 1  Changed: 1  Warnings: 0',
  protocol41: true,
  changedRows: 1 }
SELECT ==&gt;
{ id: 33,
  name: 'conan update',
  create_date: Wed Sep 11 2013 12:09:15 GMT+0800 (中国标准时间) }
{ id: 34,
  name: 'fens.me',
  create_date: Wed Sep 11 2013 12:09:15 GMT+0800 (中国标准时间) }
</code></pre>
<p>由于node的异步的，上面是一个连续的操作，代码会被写的支离破碎。我们可以通过async库对上面代码进行封装，请参考文章：<a title="Nodejs异步流程控制Async" href="http://blog.fens.me/nodejs-async/" target="_blank">Nodejs异步流程控制Async</a></p>
<p><strong>2). 连接池配置</strong></p>
<p>增加文件：app-pooling.js</p>
<pre><code>~ vi app-pooling.js

var mysql = require('mysql');
var pool = mysql.createPool({
    host: 'localhost',
    user: 'nodejs',
    password: 'nodejs',
    database: 'nodejs',
    port: 3306
});

var selectSQL = 'select * from t_user limit 10';

pool.getConnection(function (err, conn) {
    if (err) console.log("POOL ==&gt; " + err);

    conn.query(selectSQL,function(err,rows){
        if (err) console.log(err);
        console.log("SELECT ==&gt; ");
        for (var i in rows) {
            console.log(rows[i]);
        }
        conn.release();
    });
});
</code></pre>
<p>控制台输出：</p>
<pre><code>D:\workspace\javascript\nodejs-node-mysql&gt;node app-pooling.js
SELECT ==&gt;
{ id: 39,
  name: 'conan update',
  create_date: Wed Sep 11 2013 13:41:18 GMT+0800 (中国标准时间) }
{ id: 40,
  name: 'fens.me',
  create_date: Wed Sep 11 2013 13:41:18 GMT+0800 (中国标准时间) }
</code></pre>
<p><strong>3). MySQL断线重连</strong></p>
<p>分别模拟3种错误</p>
<ul>
<li>登陆密码错误</li>
<li>数据库宕机</li>
<li>数据库连接超时</li>
</ul>
<p><strong>新增文件：app-reconnect.js</strong></p>
<pre><code>~ vi app-reconnect.js

var mysql = require('mysql');
var conn;
function handleError () {
    conn = mysql.createConnection({
        host: 'localhost',
        user: 'nodejs',
        password: 'nodejs',
        database: 'nodejs',
        port: 3306
    });

    //连接错误，2秒重试
    conn.connect(function (err) {
        if (err) {
            console.log('error when connecting to db:', err);
            setTimeout(handleError , 2000);
        }
    });

    conn.on('error', function (err) {
        console.log('db error', err);
        // 如果是连接断开，自动重新连接
        if (err.code === 'PROTOCOL_CONNECTION_LOST') {
            handleError();
        } else {
            throw err;
        }
    });
}
handleError();
</code></pre>
<p><strong>a. 模拟密码错误</strong></p>
<p>修改password: &#8216;nodejs11&#8217;</p>
<p>控制台输出。</p>
<pre><code>D:\workspace\javascript\nodejs-node-mysql&gt;node app-reconnect.js
error when connecting to db: { [Error: ER_ACCESS_DENIED_ERROR: Access denied for user 'nodejs'@'localhost' (using pass
rd: YES)]
  code: 'ER_ACCESS_DENIED_ERROR',
  errno: 1045,
  sqlState: '28000',
  fatal: true }
error when connecting to db: { [Error: ER_ACCESS_DENIED_ERROR: Access denied for user 'nodejs'@'localhost' (using pass
rd: YES)]
  code: 'ER_ACCESS_DENIED_ERROR',
  errno: 1045,
  sqlState: '28000',
  fatal: true }
</code></pre>
<p><strong>b. 模拟数据库宕机</strong><br />
正常启动node，然后杀掉mysqld的进程。</p>
<p>控制台输出。</p>
<pre><code>
D:\workspace\javascript\nodejs-node-mysql&gt;node app-reconnect.js
db error { [Error: read ECONNRESET]
  code: 'ECONNRESET',
  errno: 'ECONNRESET',
  syscall: 'read',
  fatal: true }

Error: read ECONNRESET
    at errnoException (net.js:884:11)
    at TCP.onread (net.js:539:19)
</code></pre>
<p>这个异常，直接导致node程序被杀死！</p>
<p><strong>c. 模拟连接超时，PROTOCOL_CONNECTION_LOST</strong><br />
切换到root账户, 修改MySQL的wait_timeout参数，设置为10毫秒超时。</p>
<pre><code>~ mysql -uroot -p
mysql&gt; show variables like 'wait_timeout';
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| wait_timeout  | 28800 |
+---------------+-------+
1 row in set (0.00 sec)

mysql&gt; set global wait_timeout=10;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; show variables like 'wait_timeout';
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| wait_timeout  | 10    |
+---------------+-------+
1 row in set (0.00 sec)
</code></pre>
<p>修改文件：app-reconnection.js，在最后增加代码</p>
<pre><code>~ vi app-reconnection.js

function query(){
    console.log(new Date());
    var sql = "show variables like 'wait_timeout'";
    conn.query(sql, function (err, res) {
        console.log(res);
    });
}

query();
setInterval(query, 15*1000);
</code></pre>
<p>程序会每融15秒，做一次查询。</p>
<p>控制台输出</p>
<pre><code>D:\workspace\javascript\nodejs-node-mysql&gt;node app-reconnect.js
Wed Sep 11 2013 15:21:14 GMT+0800 (中国标准时间)
[ { Variable_name: 'wait_timeout', Value: '10' } ]
db error { [Error: Connection lost: The server closed the connection.] fatal: true, code: 'PROTOCOL_CONNECTION_LOST' }
Wed Sep 11 2013 15:21:28 GMT+0800 (中国标准时间)
[ { Variable_name: 'wait_timeout', Value: '10' } ]
db error { [Error: Connection lost: The server closed the connection.] fatal: true, code: 'PROTOCOL_CONNECTION_LOST' }
Wed Sep 11 2013 15:21:43 GMT+0800 (中国标准时间)
[ { Variable_name: 'wait_timeout', Value: '10' } ]
</code></pre>
<p>我们自己的程序捕获了“PROTOCOL_CONNECTION_LOST”异常，并自动的实现了数据库重连。</p>
<p><strong>4). MySQL连接池的超时测试</strong></p>
<p>针对wait_timeout问题，我们再对连接做一下测试。</p>
<p>修改app-pooling.js文件</p>
<pre><code>
var mysql = require('mysql');
var pool = mysql.createPool({
    host: 'localhost',
    user: 'nodejs',
    password: 'nodejs',
    database: 'nodejs',
    port: 3306
});

var selectSQL ="show variables like 'wait_timeout'";

pool.getConnection(function (err, conn) {
    if (err) console.log("POOL ==&gt; " + err);

    function query(){
        conn.query(selectSQL, function (err, res) {
            console.log(new Date());
            console.log(res);
            conn.release();
        });
    }
    query();
    setInterval(query, 5000);
});
</code></pre>
<p>控制台输出：</p>
<pre><code>D:\workspace\javascript\nodejs-node-mysql&gt;node app-pooling.js
Wed Sep 11 2013 15:32:25 GMT+0800 (中国标准时间)
[ { Variable_name: 'wait_timeout', Value: '10' } ]
Wed Sep 11 2013 15:32:30 GMT+0800 (中国标准时间)
[ { Variable_name: 'wait_timeout', Value: '10' } ]
Wed Sep 11 2013 15:32:35 GMT+0800 (中国标准时间)
[ { Variable_name: 'wait_timeout', Value: '10' } ]
</code></pre>
<p>连接池，已经解决了自动重连的问题了，后面我们的开发，可以尽量使用pooling的方式。</p>
<p><strong>转载请注明出处：</strong><br />
<a title="用Nodejs连接MySQL" href="http://blog.fens.me/nodejs-mysql-intro/" target="_blank">http://blog.fens.me/nodejs-mysql-intro/</a></p>
<p><img src="http://blog.fens.me/wp-content/uploads/2016/04/pay50.png" alt="打赏作者" width="600" height="400" class="alignnone size-full wp-image-8388"></p>
              <div class="clear"></div>
                            <p class="inner-meta">This entry was posted in <a href="http://blog.fens.me/category/javascript%e8%af%ad%e8%a8%80%e5%ae%9e%e8%b7%b5/" rel="category tag">Javascript语言实践</a>, <a href="http://blog.fens.me/category/%e6%95%b0%e6%8d%ae%e5%ba%93/" rel="category tag">数据库</a></p>              
            </div>
            <!-- 广告 -->
            <div id="ads"></div>        
            <div class="post comments" id="comments">              
                
<div id="disqus_thread">
            <div id="dsq-content">


            <ul id="dsq-comments">
                    <li class="post pingback">
        <p>Pingback: <a href='http://blog.fens.me/nodejs-async/' rel='external nofollow' class='url'>Nodejs异步流程控制Async | 粉丝日志</a>()</p>
    </li>
    </li><!-- #comment-## -->
    <li class="comment even thread-even depth-1" id="dsq-comment-585">
        <div id="dsq-comment-header-585" class="dsq-comment-header">
            <cite id="dsq-cite-585">
                <span id="dsq-author-user-585">sky™</span>
            </cite>
        </div>
        <div id="dsq-comment-body-585" class="dsq-comment-body">
            <div id="dsq-comment-message-585" class="dsq-comment-message"><p>很nice</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-2" id="dsq-comment-586">
        <div id="dsq-comment-header-586" class="dsq-comment-header">
            <cite id="dsq-cite-586">
                <a id="dsq-author-user-586" href="http://blog.fens.me/" target="_blank" rel="nofollow">Conan Zhang</a>
            </cite>
        </div>
        <div id="dsq-comment-body-586" class="dsq-comment-body">
            <div id="dsq-comment-message-586" class="dsq-comment-message"><p>过奖</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-1015">
        <div id="dsq-comment-header-1015" class="dsq-comment-header">
            <cite id="dsq-cite-1015">
                <span id="dsq-author-user-1015">Bunm Jyo</span>
            </cite>
        </div>
        <div id="dsq-comment-body-1015" class="dsq-comment-body">
            <div id="dsq-comment-message-1015" class="dsq-comment-message"><p>我的ubuntu xampp集成环境 命令行下连接mysql登录操作都正常，可是nodejs里面执行connect()方法就是报1045 28000的错误，求解</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-2" id="dsq-comment-1016">
        <div id="dsq-comment-header-1016" class="dsq-comment-header">
            <cite id="dsq-cite-1016">
                <a id="dsq-author-user-1016" href="http://blog.fens.me/" target="_blank" rel="nofollow">Conan Zhang</a>
            </cite>
        </div>
        <div id="dsq-comment-body-1016" class="dsq-comment-body">
            <div id="dsq-comment-message-1016" class="dsq-comment-message"><p>似乎是权限的问题。你把对应账号的权限，允许远程访问，再试一下。</p>
</div>
        </div>

    <ul class="children">
    <li class="comment even depth-3" id="dsq-comment-1017">
        <div id="dsq-comment-header-1017" class="dsq-comment-header">
            <cite id="dsq-cite-1017">
                <span id="dsq-author-user-1017">Bunm Jyo</span>
            </cite>
        </div>
        <div id="dsq-comment-body-1017" class="dsq-comment-body">
            <div id="dsq-comment-message-1017" class="dsq-comment-message"><p>权限是没问题的，我另外一台电脑的windows都能正常使用root访问；是否会是xampp集成环境还是my.cnf的文件权限？my.cnf的默认文件权限是多少呢？</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-4" id="dsq-comment-1019">
        <div id="dsq-comment-header-1019" class="dsq-comment-header">
            <cite id="dsq-cite-1019">
                <a id="dsq-author-user-1019" href="http://blog.fens.me/" target="_blank" rel="nofollow">Conan Zhang</a>
            </cite>
        </div>
        <div id="dsq-comment-body-1019" class="dsq-comment-body">
            <div id="dsq-comment-message-1019" class="dsq-comment-message"><p>我不清楚xampp</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment even depth-3" id="dsq-comment-1018">
        <div id="dsq-comment-header-1018" class="dsq-comment-header">
            <cite id="dsq-cite-1018">
                <span id="dsq-author-user-1018">Bunm Jyo</span>
            </cite>
        </div>
        <div id="dsq-comment-body-1018" class="dsq-comment-body">
            <div id="dsq-comment-message-1018" class="dsq-comment-message"><p>Express server listening on port 3000</p>
<p>{ [Error: ER_ACCESS_DENIED_ERROR: Access denied for user &#8216;root&#8217;@&#8217;localhost&#8217; (using password: YES)]<br />
  code: &#8216;ER_ACCESS_DENIED_ERROR&#8217;,</p>
<p>  errno: 1045,</p>
<p>  sqlState: &#8216;28000&#8217;,</p>
<p>  fatal: true }</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-4" id="dsq-comment-1020">
        <div id="dsq-comment-header-1020" class="dsq-comment-header">
            <cite id="dsq-cite-1020">
                <a id="dsq-author-user-1020" href="http://blog.fens.me/" target="_blank" rel="nofollow">Conan Zhang</a>
            </cite>
        </div>
        <div id="dsq-comment-body-1020" class="dsq-comment-body">
            <div id="dsq-comment-message-1020" class="dsq-comment-message"><p>很明显的权限问题，允许远程访问就行了，虽然root这么做很不安全。</p>
<p>类似下面的语句<br />
GRANT ALL PRIVILEGES ON *.* TO root@%*%</p>
</div>
        </div>

    <ul class="children">
    <li class="comment even depth-5" id="dsq-comment-1021">
        <div id="dsq-comment-header-1021" class="dsq-comment-header">
            <cite id="dsq-cite-1021">
                <span id="dsq-author-user-1021">Bunm Jyo</span>
            </cite>
        </div>
        <div id="dsq-comment-body-1021" class="dsq-comment-body">
            <div id="dsq-comment-message-1021" class="dsq-comment-message"><p>已经可以通过另外一台电脑局域网远程访问了，但是就node无法连接；蛋都疼裂了～～ =。=<br />
休息吧，感谢</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment odd alt depth-5" id="dsq-comment-1029">
        <div id="dsq-comment-header-1029" class="dsq-comment-header">
            <cite id="dsq-cite-1029">
                <span id="dsq-author-user-1029">Bunm Jyo</span>
            </cite>
        </div>
        <div id="dsq-comment-body-1029" class="dsq-comment-body">
            <div id="dsq-comment-message-1029" class="dsq-comment-message"><p>在windows下调试ok了,<br />
貌似不是数据库的配置问题,应该是linux的哪个权限出了问题;我再找找原因,搞定后给结贴</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment even depth-5" id="dsq-comment-1030">
        <div id="dsq-comment-header-1030" class="dsq-comment-header">
            <cite id="dsq-cite-1030">
                <span id="dsq-author-user-1030">Bunm Jyo</span>
            </cite>
        </div>
        <div id="dsq-comment-body-1030" class="dsq-comment-body">
            <div id="dsq-comment-message-1030" class="dsq-comment-message"><p>问题,在linux下的nodejs 代码,访问mysql建立连接,若密码为空,则能正常连接,若有密码,就一定提示上面的密码错误 1045.确认密码是正确的,linux 命令行下相同密码都能正常连接访问.问题出在哪里呢?是nodejs代码还是linux系统?应该排除mysql库的配置问题,因为在windows平台下相同的库,都是正常的说</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment odd alt depth-5" id="dsq-comment-1033">
        <div id="dsq-comment-header-1033" class="dsq-comment-header">
            <cite id="dsq-cite-1033">
                <a id="dsq-author-user-1033" href="http://blog.fens.me/" target="_blank" rel="nofollow">Conan Zhang</a>
            </cite>
        </div>
        <div id="dsq-comment-body-1033" class="dsq-comment-body">
            <div id="dsq-comment-message-1033" class="dsq-comment-message"><p>没看明白，你说的。</p>
<p>1. MySQL运行在什么系统？<br />
2. Node运行在什么系统？<br />
3. MySQL和Node是不是同一台机器？<br />
4. MySQL的访问账号的密码是空还是非空？访问账号是否已支持远程访问？</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment even thread-even depth-1" id="dsq-comment-1101">
        <div id="dsq-comment-header-1101" class="dsq-comment-header">
            <cite id="dsq-cite-1101">
                <span id="dsq-author-user-1101">liuwu</span>
            </cite>
        </div>
        <div id="dsq-comment-body-1101" class="dsq-comment-body">
            <div id="dsq-comment-message-1101" class="dsq-comment-message"><p>代码有上传吗</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-2" id="dsq-comment-1104">
        <div id="dsq-comment-header-1104" class="dsq-comment-header">
            <cite id="dsq-cite-1104">
                <a id="dsq-author-user-1104" href="http://blog.fens.me/" target="_blank" rel="nofollow">Conan Zhang</a>
            </cite>
        </div>
        <div id="dsq-comment-body-1104" class="dsq-comment-body">
            <div id="dsq-comment-message-1104" class="dsq-comment-message"><p>核心代码都在文章里写了，没有单独上传。</p>
</div>
        </div>

    <ul class="children">
    <li class="comment even depth-3" id="dsq-comment-1109">
        <div id="dsq-comment-header-1109" class="dsq-comment-header">
            <cite id="dsq-cite-1109">
                <span id="dsq-author-user-1109">liuwu</span>
            </cite>
        </div>
        <div id="dsq-comment-body-1109" class="dsq-comment-body">
            <div id="dsq-comment-message-1109" class="dsq-comment-message"><p>你好，我按照文章操作<br />
 连接池配置</p>
<p>增加文件：app-pooling.js<br />
老是提示没有mysql.createPool方法。</p>
<p>我的系统环境</p>
<p>win7 64bit</p>
<p>Nodejs:v0.10.26<br />
Npm:1.4.13</p>
<p>MySQL:5.6.16</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-4" id="dsq-comment-1137">
        <div id="dsq-comment-header-1137" class="dsq-comment-header">
            <cite id="dsq-cite-1137">
                <a id="dsq-author-user-1137" href="http://blog.fens.me/" target="_blank" rel="nofollow">Conan Zhang</a>
            </cite>
        </div>
        <div id="dsq-comment-body-1137" class="dsq-comment-body">
            <div id="dsq-comment-message-1137" class="dsq-comment-message"><p>两个可能的问题：</p>
<p>没有安装mysql库<br />
npm install mysql@2.0.0-alpha9</p>
<p>没有增加mysql引用<br />
var mysql = require(&#8216;mysql&#8217;);</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-1112">
        <div id="dsq-comment-header-1112" class="dsq-comment-header">
            <cite id="dsq-cite-1112">
                <span id="dsq-author-user-1112">skyweaver</span>
            </cite>
        </div>
        <div id="dsq-comment-body-1112" class="dsq-comment-body">
            <div id="dsq-comment-message-1112" class="dsq-comment-message"><p>think you very much</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment odd alt thread-even depth-1" id="dsq-comment-1113">
        <div id="dsq-comment-header-1113" class="dsq-comment-header">
            <cite id="dsq-cite-1113">
                <span id="dsq-author-user-1113">skyweaver</span>
            </cite>
        </div>
        <div id="dsq-comment-body-1113" class="dsq-comment-body">
            <div id="dsq-comment-message-1113" class="dsq-comment-message"><p>thank you very much</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-1132">
        <div id="dsq-comment-header-1132" class="dsq-comment-header">
            <cite id="dsq-cite-1132">
                <span id="dsq-author-user-1132">mikan</span>
            </cite>
        </div>
        <div id="dsq-comment-body-1132" class="dsq-comment-body">
            <div id="dsq-comment-message-1132" class="dsq-comment-message"><p>想问下lz，mysql的事务怎么控制</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-2" id="dsq-comment-1342">
        <div id="dsq-comment-header-1342" class="dsq-comment-header">
            <cite id="dsq-cite-1342">
                <a id="dsq-author-user-1342" href="http://blog.fens.me/" target="_blank" rel="nofollow">Conan Zhang</a>
            </cite>
        </div>
        <div id="dsq-comment-body-1342" class="dsq-comment-body">
            <div id="dsq-comment-message-1342" class="dsq-comment-message"><p>我还没有考虑过用node控制事务！</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment even thread-even depth-1" id="dsq-comment-1341">
        <div id="dsq-comment-header-1341" class="dsq-comment-header">
            <cite id="dsq-cite-1341">
                <span id="dsq-author-user-1341">zhumingpeng</span>
            </cite>
        </div>
        <div id="dsq-comment-body-1341" class="dsq-comment-body">
            <div id="dsq-comment-message-1341" class="dsq-comment-message"><p>悲剧  什���都安装了。。还是不行。。。搞了好久了。。上图 大神帮我看看</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-2" id="dsq-comment-1346">
        <div id="dsq-comment-header-1346" class="dsq-comment-header">
            <cite id="dsq-cite-1346">
                <a id="dsq-author-user-1346" href="http://blog.fens.me/" target="_blank" rel="nofollow">Conan Zhang</a>
            </cite>
        </div>
        <div id="dsq-comment-body-1346" class="dsq-comment-body">
            <div id="dsq-comment-message-1346" class="dsq-comment-message"><p>你的执行目录不对吧</p>
<p>1. Desktoptoptempnodedata.js 这是执行文件，但你的安装的MySQL库在E:programnodejs下面。</p>
<p>2. 每个node项目，都需要下载对应的库，如同Java，而不是像Python,PHP统一安装Node软件中。</p>
<p>3. 你可以在Desktoptoptempnode，目录再重新安装mysql库，应该就可以运行了。</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-1434">
        <div id="dsq-comment-header-1434" class="dsq-comment-header">
            <cite id="dsq-cite-1434">
                <span id="dsq-author-user-1434">Yumiao Yan</span>
            </cite>
        </div>
        <div id="dsq-comment-body-1434" class="dsq-comment-body">
            <div id="dsq-comment-message-1434" class="dsq-comment-message"><p>well,nice</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-2" id="dsq-comment-1436">
        <div id="dsq-comment-header-1436" class="dsq-comment-header">
            <cite id="dsq-cite-1436">
                <a id="dsq-author-user-1436" href="http://blog.fens.me/" target="_blank" rel="nofollow">Conan Zhang</a>
            </cite>
        </div>
        <div id="dsq-comment-body-1436" class="dsq-comment-body">
            <div id="dsq-comment-message-1436" class="dsq-comment-message"><p>🙂</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment even thread-even depth-1" id="dsq-comment-1455">
        <div id="dsq-comment-header-1455" class="dsq-comment-header">
            <cite id="dsq-cite-1455">
                <span id="dsq-author-user-1455">aballam</span>
            </cite>
        </div>
        <div id="dsq-comment-body-1455" class="dsq-comment-body">
            <div id="dsq-comment-message-1455" class="dsq-comment-message"><p>我可以同时创建多个连接吗？<br />
 var testCon = connectMysql(&#8220;test&#8221;);<br />
 var prodCon = connectMysql(&#8220;prod&#8221;);</p>
<p>例如这样我需要同时更新测试服务器和生产环境的数据库，不知道是怎么同时创建多个连接实例的呢</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-2" id="dsq-comment-1456">
        <div id="dsq-comment-header-1456" class="dsq-comment-header">
            <cite id="dsq-cite-1456">
                <a id="dsq-author-user-1456" href="http://blog.fens.me/" target="_blank" rel="nofollow">Conan Zhang</a>
            </cite>
        </div>
        <div id="dsq-comment-body-1456" class="dsq-comment-body">
            <div id="dsq-comment-message-1456" class="dsq-comment-message"><p>可以创建多个连接，和创建一个是一样的。</p>
<p>var pool1 = mysql.createPool({});<br />
var pool2 = mysql.createPool({});</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-1488">
        <div id="dsq-comment-header-1488" class="dsq-comment-header">
            <cite id="dsq-cite-1488">
                <span id="dsq-author-user-1488">Sylar</span>
            </cite>
        </div>
        <div id="dsq-comment-body-1488" class="dsq-comment-body">
            <div id="dsq-comment-message-1488" class="dsq-comment-message"><p>请问 连接池的自动重连的问题 我们不用关注吗？<br />
也就是说所有它自己会有重链的机制？</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-2" id="dsq-comment-1491">
        <div id="dsq-comment-header-1491" class="dsq-comment-header">
            <cite id="dsq-cite-1491">
                <a id="dsq-author-user-1491" href="http://blog.fens.me/" target="_blank" rel="nofollow">Conan Zhang</a>
            </cite>
        </div>
        <div id="dsq-comment-body-1491" class="dsq-comment-body">
            <div id="dsq-comment-message-1491" class="dsq-comment-message"><p>是的，会自动重连，我们不用管他。</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment even thread-even depth-1" id="dsq-comment-1489">
        <div id="dsq-comment-header-1489" class="dsq-comment-header">
            <cite id="dsq-cite-1489">
                <span id="dsq-author-user-1489">Sylar</span>
            </cite>
        </div>
        <div id="dsq-comment-body-1489" class="dsq-comment-body">
            <div id="dsq-comment-message-1489" class="dsq-comment-message"><p>另外 如果我从连接池里面拿的链接 超时了应该怎么处理？<br />
我看了下 貌似没有可以配置链接池里面链接的超时时间的选项</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-2" id="dsq-comment-1492">
        <div id="dsq-comment-header-1492" class="dsq-comment-header">
            <cite id="dsq-cite-1492">
                <a id="dsq-author-user-1492" href="http://blog.fens.me/" target="_blank" rel="nofollow">Conan Zhang</a>
            </cite>
        </div>
        <div id="dsq-comment-body-1492" class="dsq-comment-body">
            <div id="dsq-comment-message-1492" class="dsq-comment-message"><p>怎么会没有配置呢？<br />
你以“超时”为关键字搜索文章内容，我在文章中已经明确测试了超时的情况。</p>
</div>
        </div>

    <ul class="children">
    <li class="comment even depth-3" id="dsq-comment-1494">
        <div id="dsq-comment-header-1494" class="dsq-comment-header">
            <cite id="dsq-cite-1494">
                <span id="dsq-author-user-1494">Sylar</span>
            </cite>
        </div>
        <div id="dsq-comment-body-1494" class="dsq-comment-body">
            <div id="dsq-comment-message-1494" class="dsq-comment-message"><p>谢谢您的回答！！<br />
是这样的<br />
				resourcePool.getConnection(function(err, connection) {<br />
		if (err){<br />
			if(err.code==&#8217;ETIMEDOUT&#8217;){<br />
				//connection timeout<br />
				//if failed will crash<br />
				console.log(&#8216;sorry this connection is timeout!&#8217;);<br />
				throw err;<br />
			}</p>
<p>		}<br />
    connection.query(sql, function(err, result) {<br />
        if (err) throw err;<br />
        connection.release();<br />
        resolve(result);<br />
    });<br />
});<br />
我想在sorry this connection is timeout这里捕获链接超时。 我在pool中设置了<br />
            waitForConnections : true,<br />
            connectionLimit : 10,<br />
            queueLimit : 100,<br />
            connectTimeout : 1</p>
<p>但是确实能捕获一种超时，但是这种错误会导致程序直接被杀掉<br />
我是想问  这种连接池中的链接的超时问题我们怎么捕获和解决呢？<br />
我看了下github的issue 有一个https://github.com/felixge/node-mysql/pull/726<br />
这个貌似增加了connecTimeout的属性</p>
<p>但是我得到的错误是error: uncaughtExceptionError: Can&#8217;t set headers after they are sent.</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-4" id="dsq-comment-1498">
        <div id="dsq-comment-header-1498" class="dsq-comment-header">
            <cite id="dsq-cite-1498">
                <a id="dsq-author-user-1498" href="http://blog.fens.me/" target="_blank" rel="nofollow">Conan Zhang</a>
            </cite>
        </div>
        <div id="dsq-comment-body-1498" class="dsq-comment-body">
            <div id="dsq-comment-message-1498" class="dsq-comment-message"><p>你可以自己处理 uncaughtException 这个错误，但要用另一处方式。</p>
<p>参考文章：<br />
<a href="http://blog.fens.me/nodejs-core-domain/" rel="nofollow">http://blog.fens.me/nodejs-core-domain/</a> ‎</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="post pingback">
        <p>Pingback: <a href='http://blog.fens.me/nodejs-roadmap/' rel='external nofollow' class='url'>Nodejs学习路线图 | 粉丝日志</a>()</p>
    </li>
    </li><!-- #comment-## -->
    <li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-2249">
        <div id="dsq-comment-header-2249" class="dsq-comment-header">
            <cite id="dsq-cite-2249">
                <span id="dsq-author-user-2249">kevinleeleelily</span>
            </cite>
        </div>
        <div id="dsq-comment-body-2249" class="dsq-comment-body">
            <div id="dsq-comment-message-2249" class="dsq-comment-message"><p>您好，请问，我直接从数据库里取出数据用render传值到页面不可以吗？怎么传过去的是都是Object对象呢？不用Ajax的话得怎么做呢？</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-2" id="dsq-comment-2252">
        <div id="dsq-comment-header-2252" class="dsq-comment-header">
            <cite id="dsq-cite-2252">
                <a id="dsq-author-user-2252" href="http://blog.fens.me/" target="_blank" rel="nofollow">Conan Zhang</a>
            </cite>
        </div>
        <div id="dsq-comment-body-2252" class="dsq-comment-body">
            <div id="dsq-comment-message-2252" class="dsq-comment-message"><p>1. 可以用render直接到页面<br />
2. sql取出来的，都是Array类型的 [{},{},{}]<br />
3. 和Ajax没啥关系吧。</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment even thread-even depth-1" id="dsq-comment-2812">
        <div id="dsq-comment-header-2812" class="dsq-comment-header">
            <cite id="dsq-cite-2812">
                <span id="dsq-author-user-2812">rookie</span>
            </cite>
        </div>
        <div id="dsq-comment-body-2812" class="dsq-comment-body">
            <div id="dsq-comment-message-2812" class="dsq-comment-message"><p>你好，我用了你的重连方法，后来提示Cannot enqueue Query after fatal error.是出错后不能访问数据库了，可是按道理我重新建立连接了啊，后来我查看日志，db error { [Error: Connection lost: The server closed the connection.] fatal: true, code: &#8216;PROTOCOL_CONNECTION_LOST&#8217; }<br />
Error: Connection lost: The server closed the connection.这是什么情况？</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-2" id="dsq-comment-2813">
        <div id="dsq-comment-header-2813" class="dsq-comment-header">
            <cite id="dsq-cite-2813">
                <span id="dsq-author-user-2813">rookie</span>
            </cite>
        </div>
        <div id="dsq-comment-body-2813" class="dsq-comment-body">
            <div id="dsq-comment-message-2813" class="dsq-comment-message"><p>诡异，看样子连接是重新建立了，我随便修改了一行代码，就可以了<br />
这是什么诡异问题,跟缓存有关？</p>
</div>
        </div>

    <ul class="children">
    <li class="comment even depth-3" id="dsq-comment-2814">
        <div id="dsq-comment-header-2814" class="dsq-comment-header">
            <cite id="dsq-cite-2814">
                <span id="dsq-author-user-2814">rookie</span>
            </cite>
        </div>
        <div id="dsq-comment-body-2814" class="dsq-comment-body">
            <div id="dsq-comment-message-2814" class="dsq-comment-message"><p>应该是这样的，我开发环境用的supervior，随便改了代码，相当重启了服务器，感觉问题还在。</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment odd alt depth-2" id="dsq-comment-2817">
        <div id="dsq-comment-header-2817" class="dsq-comment-header">
            <cite id="dsq-cite-2817">
                <a id="dsq-author-user-2817" href="http://blog.fens.me/" target="_blank" rel="nofollow">Conan Zhang</a>
            </cite>
        </div>
        <div id="dsq-comment-body-2817" class="dsq-comment-body">
            <div id="dsq-comment-message-2817" class="dsq-comment-message"><p>这个错误看起来是MySQL数据库端的问题，服务器关闭的连接，不是客户端的问题。</p>
</div>
        </div>

    <ul class="children">
    <li class="comment even depth-3" id="dsq-comment-2818">
        <div id="dsq-comment-header-2818" class="dsq-comment-header">
            <cite id="dsq-cite-2818">
                <span id="dsq-author-user-2818">rookie</span>
            </cite>
        </div>
        <div id="dsq-comment-body-2818" class="dsq-comment-body">
            <div id="dsq-comment-message-2818" class="dsq-comment-message"><p>我每天晚上走好好的，第二天早上来就连不上了，而且提示PROTOCOL_CONNECTION_LOST，按道理，我有捕获error然后重新建立连接啊，我打算今天用连接池试一试</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-4" id="dsq-comment-2820">
        <div id="dsq-comment-header-2820" class="dsq-comment-header">
            <cite id="dsq-cite-2820">
                <a id="dsq-author-user-2820" href="http://blog.fens.me/" target="_blank" rel="nofollow">Conan Zhang</a>
            </cite>
        </div>
        <div id="dsq-comment-body-2820" class="dsq-comment-body">
            <div id="dsq-comment-message-2820" class="dsq-comment-message"><p>连接池可以解决自动重连的问题，自己手动重连，有很多细节要注意。</p>
</div>
        </div>

    <ul class="children">
    <li class="comment even depth-5" id="dsq-comment-3569">
        <div id="dsq-comment-header-3569" class="dsq-comment-header">
            <cite id="dsq-cite-3569">
                <span id="dsq-author-user-3569">fei</span>
            </cite>
        </div>
        <div id="dsq-comment-body-3569" class="dsq-comment-body">
            <div id="dsq-comment-message-3569" class="dsq-comment-message"><p>error处理之前,用conn发起了访问,PROTOCOL_ENQUEUE_AFTER_FATAL_ERROR,之后就不再报error了,没机会重连</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment odd alt depth-5" id="dsq-comment-3575">
        <div id="dsq-comment-header-3575" class="dsq-comment-header">
            <cite id="dsq-cite-3575">
                <a id="dsq-author-user-3575" href="http://blog.fens.me/" target="_blank" rel="nofollow">Conan Zhang</a>
            </cite>
        </div>
        <div id="dsq-comment-body-3575" class="dsq-comment-body">
            <div id="dsq-comment-message-3575" class="dsq-comment-message"><p>我好像没有遇到过，你说的问题。</p>
<p>node-mysql对于这个问题，已经Closed了。<br />
<a href="https://github.com/felixge/node-mysql/issues/900" rel="nofollow">https://github.com/felixge/node-mysql/issues/900</a></p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment even depth-2" id="dsq-comment-5078">
        <div id="dsq-comment-header-5078" class="dsq-comment-header">
            <cite id="dsq-cite-5078">
                <span id="dsq-author-user-5078">XChen</span>
            </cite>
        </div>
        <div id="dsq-comment-body-5078" class="dsq-comment-body">
            <div id="dsq-comment-message-5078" class="dsq-comment-message"><p>这可能是因为你将mysql 部分封装了，exports了connection，便重新连接之后，connection并没有更新，其实是一个js的理解问题。</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-3" id="dsq-comment-5083">
        <div id="dsq-comment-header-5083" class="dsq-comment-header">
            <cite id="dsq-cite-5083">
                <a id="dsq-author-user-5083" href="http://blog.fens.me/" target="_blank" rel="nofollow">Conan Zhang</a>
            </cite>
        </div>
        <div id="dsq-comment-body-5083" class="dsq-comment-body">
            <div id="dsq-comment-message-5083" class="dsq-comment-message"><p>应该是这么回事。</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-2950">
        <div id="dsq-comment-header-2950" class="dsq-comment-header">
            <cite id="dsq-cite-2950">
                <span id="dsq-author-user-2950">damon</span>
            </cite>
        </div>
        <div id="dsq-comment-body-2950" class="dsq-comment-body">
            <div id="dsq-comment-message-2950" class="dsq-comment-message"><p>function query(){<br />
    console.log(new Date());<br />
    var sql = &#8220;show variables like &#8216;wait_timeout'&#8221;;<br />
    conn.query(sql, function (err, res) {<br />
        console.log(res);<br />
    });<br />
}</p>
<p>query();<br />
setInterval(query, 15*1000);<br />
你没有报  Connection already released  的错误吗？</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-2" id="dsq-comment-2952">
        <div id="dsq-comment-header-2952" class="dsq-comment-header">
            <cite id="dsq-cite-2952">
                <a id="dsq-author-user-2952" href="http://blog.fens.me/" target="_blank" rel="nofollow">Conan Zhang</a>
            </cite>
        </div>
        <div id="dsq-comment-body-2952" class="dsq-comment-body">
            <div id="dsq-comment-message-2952" class="dsq-comment-message"><p>你的代码似乎有点问题，conn变量，如果是全局变量，很有可能会出现你这样的错误。</p>
</div>
        </div>

    <ul class="children">
    <li class="comment even depth-3" id="dsq-comment-4705">
        <div id="dsq-comment-header-4705" class="dsq-comment-header">
            <cite id="dsq-cite-4705">
                <span id="dsq-author-user-4705">Xiangxuan Qu</span>
            </cite>
        </div>
        <div id="dsq-comment-body-4705" class="dsq-comment-body">
            <div id="dsq-comment-message-4705" class="dsq-comment-message"><p>丹哥您好，复制您的代码之后，我也是这个问题</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-4" id="dsq-comment-4760">
        <div id="dsq-comment-header-4760" class="dsq-comment-header">
            <cite id="dsq-cite-4760">
                <a id="dsq-author-user-4760" href="http://blog.fens.me/" target="_blank" rel="nofollow">Conan Zhang</a>
            </cite>
        </div>
        <div id="dsq-comment-body-4760" class="dsq-comment-body">
            <div id="dsq-comment-message-4760" class="dsq-comment-message"><p>多做一步检查<br />
var pool = null;<br />
if(pool ==null){<br />
   pool = mysql.createPool({<br />
}<br />
让mysql.createPool()只执行一次，变成单例的方法。</p>
</div>
        </div>

    <ul class="children">
    <li class="comment even depth-5" id="dsq-comment-4853">
        <div id="dsq-comment-header-4853" class="dsq-comment-header">
            <cite id="dsq-cite-4853">
                <span id="dsq-author-user-4853">Xiangxuan Qu</span>
            </cite>
        </div>
        <div id="dsq-comment-body-4853" class="dsq-comment-body">
            <div id="dsq-comment-message-4853" class="dsq-comment-message"><p>多谢丹哥</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment odd alt depth-4" id="dsq-comment-4863">
        <div id="dsq-comment-header-4863" class="dsq-comment-header">
            <cite id="dsq-cite-4863">
                <a id="dsq-author-user-4863" href="http://blog.fens.me/" target="_blank" rel="nofollow">Conan Zhang</a>
            </cite>
        </div>
        <div id="dsq-comment-body-4863" class="dsq-comment-body">
            <div id="dsq-comment-message-4863" class="dsq-comment-message"><p>让mysql.createPool()只执行一次，变成单例的方法。</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment even thread-even depth-1" id="dsq-comment-3108">
        <div id="dsq-comment-header-3108" class="dsq-comment-header">
            <cite id="dsq-cite-3108">
                <span id="dsq-author-user-3108">赵继宗</span>
            </cite>
        </div>
        <div id="dsq-comment-body-3108" class="dsq-comment-body">
            <div id="dsq-comment-message-3108" class="dsq-comment-message"><p>正在使用node-mysql，就看到了博主的文章，赞赞赞赞</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-2" id="dsq-comment-3109">
        <div id="dsq-comment-header-3109" class="dsq-comment-header">
            <cite id="dsq-cite-3109">
                <a id="dsq-author-user-3109" href="http://blog.fens.me/" target="_blank" rel="nofollow">Conan Zhang</a>
            </cite>
        </div>
        <div id="dsq-comment-body-3109" class="dsq-comment-body">
            <div id="dsq-comment-message-3109" class="dsq-comment-message"><p>🙂</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-3420">
        <div id="dsq-comment-header-3420" class="dsq-comment-header">
            <cite id="dsq-cite-3420">
                <a id="dsq-author-user-3420" href="http://www.xuanfengge.com/" target="_blank" rel="nofollow">ivan</a>
            </cite>
        </div>
        <div id="dsq-comment-body-3420" class="dsq-comment-body">
            <div id="dsq-comment-message-3420" class="dsq-comment-message"><p>mark 好好学习下</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment odd alt thread-even depth-1" id="dsq-comment-3895">
        <div id="dsq-comment-header-3895" class="dsq-comment-header">
            <cite id="dsq-cite-3895">
                <span id="dsq-author-user-3895">小xixi</span>
            </cite>
        </div>
        <div id="dsq-comment-body-3895" class="dsq-comment-body">
            <div id="dsq-comment-message-3895" class="dsq-comment-message"><p>你好，为什么明明我已经在nodejs目录下，npm install mysql@2.0.0-alpha9，可为什么还是报can not find module mysql的错误呢？？急切希望得到指导和帮助</p>
</div>
        </div>

    <ul class="children">
    <li class="comment even depth-2" id="dsq-comment-3931">
        <div id="dsq-comment-header-3931" class="dsq-comment-header">
            <cite id="dsq-cite-3931">
                <a id="dsq-author-user-3931" href="http://blog.fens.me/" target="_blank" rel="nofollow">Conan Zhang</a>
            </cite>
        </div>
        <div id="dsq-comment-body-3931" class="dsq-comment-body">
            <div id="dsq-comment-message-3931" class="dsq-comment-message"><p>npm install mysql</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment odd alt depth-2" id="dsq-comment-4099">
        <div id="dsq-comment-header-4099" class="dsq-comment-header">
            <cite id="dsq-cite-4099">
                <span id="dsq-author-user-4099">风……清</span>
            </cite>
        </div>
        <div id="dsq-comment-body-4099" class="dsq-comment-body">
            <div id="dsq-comment-message-4099" class="dsq-comment-message"><p>在node-demo下npm install mysql</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-4160">
        <div id="dsq-comment-header-4160" class="dsq-comment-header">
            <cite id="dsq-cite-4160">
                <span id="dsq-author-user-4160">hbedw</span>
            </cite>
        </div>
        <div id="dsq-comment-body-4160" class="dsq-comment-body">
            <div id="dsq-comment-message-4160" class="dsq-comment-message"><p>文章不错哈 攒一个</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-2" id="dsq-comment-4164">
        <div id="dsq-comment-header-4164" class="dsq-comment-header">
            <cite id="dsq-cite-4164">
                <a id="dsq-author-user-4164" href="http://blog.fens.me/" target="_blank" rel="nofollow">Conan Zhang</a>
            </cite>
        </div>
        <div id="dsq-comment-body-4164" class="dsq-comment-body">
            <div id="dsq-comment-message-4164" class="dsq-comment-message"><p>🙂</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment even thread-even depth-1" id="dsq-comment-4556">
        <div id="dsq-comment-header-4556" class="dsq-comment-header">
            <cite id="dsq-cite-4556">
                <span id="dsq-author-user-4556">xiaolin</span>
            </cite>
        </div>
        <div id="dsq-comment-body-4556" class="dsq-comment-body">
            <div id="dsq-comment-message-4556" class="dsq-comment-message"><p>楼主，我有个问题想请教你，就是如果我在多个地方加载了这个app-pooling.js文件，那么会不会创建多个连接池出来呢？这个连接池是单例的吗？</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-2" id="dsq-comment-4561">
        <div id="dsq-comment-header-4561" class="dsq-comment-header">
            <cite id="dsq-cite-4561">
                <a id="dsq-author-user-4561" href="http://blog.fens.me/" target="_blank" rel="nofollow">Conan Zhang</a>
            </cite>
        </div>
        <div id="dsq-comment-body-4561" class="dsq-comment-body">
            <div id="dsq-comment-message-4561" class="dsq-comment-message"><p>会创建多个池。</p>
<p>所以，pool这个变量最好全局变量，第二次创建是判断变量是否有值，要自己做单例。</p>
</div>
        </div>

    <ul class="children">
    <li class="comment even depth-3" id="dsq-comment-4564">
        <div id="dsq-comment-header-4564" class="dsq-comment-header">
            <cite id="dsq-cite-4564">
                <span id="dsq-author-user-4564">xiaolin</span>
            </cite>
        </div>
        <div id="dsq-comment-body-4564" class="dsq-comment-body">
            <div id="dsq-comment-message-4564" class="dsq-comment-message"><p>感谢楼主~<br />
但是现在我的疑惑更多了<br />
baseDao.js，代码如下：<br />
var pool = mysql.createPool(options);<br />
module.exports = {<br />
获取连接，执行响应查询<br />
}</p>
<p>template.js，代码如下：<br />
var pool = mysql.createPool(options);<br />
module.exports = {<br />
获取连接，执行响应查询<br />
}<br />
问题一：<br />
只创建一次的时候，数据库是不是应该有10个连接呢？我看代码里面默认是10条，我没有做限制。<br />
问题二：<br />
我在一个路由中调用了这两个文件中的方法，但是我看数据库连接也不是更多了，跟创建一次连接池是一样的，这是为什么呢？</p>
<p>ps：我每次查询后释放了连接</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-4576">
        <div id="dsq-comment-header-4576" class="dsq-comment-header">
            <cite id="dsq-cite-4576">
                <span id="dsq-author-user-4576">ll</span>
            </cite>
        </div>
        <div id="dsq-comment-body-4576" class="dsq-comment-body">
            <div id="dsq-comment-message-4576" class="dsq-comment-message"><p>请问,在a.js中module.exports.a = function(){conn.query的操作}, b.js调用a(),如何才能拿到conn.query里面的数据..这个操作是异步的, 怎么写回调呢?</p>
</div>
        </div>

    <ul class="children">
    <li class="comment even depth-2" id="dsq-comment-4577">
        <div id="dsq-comment-header-4577" class="dsq-comment-header">
            <cite id="dsq-cite-4577">
                <a id="dsq-author-user-4577" href="http://blog.fens.me/" target="_blank" rel="nofollow">Conan Zhang</a>
            </cite>
        </div>
        <div id="dsq-comment-body-4577" class="dsq-comment-body">
            <div id="dsq-comment-message-4577" class="dsq-comment-message"><p>pool，是全局变量</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment odd alt thread-even depth-1" id="dsq-comment-4868">
        <div id="dsq-comment-header-4868" class="dsq-comment-header">
            <cite id="dsq-cite-4868">
                <span id="dsq-author-user-4868">Albee_na</span>
            </cite>
        </div>
        <div id="dsq-comment-body-4868" class="dsq-comment-body">
            <div id="dsq-comment-message-4868" class="dsq-comment-message"><p>您好，我最近刚学的node.js，然后要用node.js连接MySQL，将数据库中的内容显示出来。我已经安装了node，也安了MySQL，刚刚看了一下您上面的代码，觉得有点困惑，我是要重新安装node和MySQL吗？</p>
</div>
        </div>

    </li><!-- #comment-## -->
            </ul>


        </div>

    </div>

<script type="text/javascript">
var disqus_url = 'http://blog.fens.me/nodejs-mysql-intro/';
var disqus_identifier = '2343 http://blog.fens.me/?p=2343';
var disqus_container_id = 'disqus_thread';
var disqus_shortname = 'bsspirit';
var disqus_title = "用Nodejs连接MySQL";
var disqus_config_custom = window.disqus_config;
var disqus_config = function () {
    /*
    All currently supported events:
    onReady: fires when everything is ready,
    onNewComment: fires when a new comment is posted,
    onIdentify: fires when user is authenticated
    */
    
    
    this.language = '';
        this.callbacks.onReady.push(function () {

        // sync comments in the background so we don't block the page
        var script = document.createElement('script');
        script.async = true;
        script.src = '?cf_action=sync_comments&post_id=2343';

        var firstScript = document.getElementsByTagName('script')[0];
        firstScript.parentNode.insertBefore(script, firstScript);
    });
    
    if (disqus_config_custom) {
        disqus_config_custom.call(this);
    }
};

(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>

            </div>
          </div>
       </div>
    
</div> <!-- END Narrowcolumn -->

<div id="sidebar" class="profile">
 <ul>
<li id="widget_nav_menu" class="widget png_scale"><h2 class="blocktitle"><span>站内导航</span></h2><div class="menu-menu-1-container"><ul id="menu-menu-1" class="menu"><li id="menu-item-2328" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2328"><a href="http://blog.fens.me/series-r/">R的极客理想系列文章</a></li>
<li id="menu-item-2329" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2329"><a href="http://blog.fens.me/series-nodejs/">从零开始nodejs系列文章</a></li>
<li id="menu-item-2338" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2338"><a href="http://blog.fens.me/series-it-finance/">用IT技术玩金融系列文章</a></li>
<li id="menu-item-6505" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6505"><a href="http://blog.fens.me/series-meeting/">跨界知识聚会系列文章</a></li>
<li id="menu-item-2339" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2339"><a href="http://blog.fens.me/series-hadoop-family/">Hadoop家族系列文章</a></li>
<li id="menu-item-2337" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2337"><a href="http://blog.fens.me/series-angular/">AngularJS体验式编程系列文章</a></li>
<li id="menu-item-2331" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2331"><a href="http://blog.fens.me/series-rhadoop/">RHadoop实践系列文章</a></li>
<li id="menu-item-2330" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2330"><a href="http://blog.fens.me/series-java/">无所不能的Java系列文章</a></li>
<li id="menu-item-2336" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2336"><a href="http://blog.fens.me/series-ubuntu/">ubuntu实用工具系列文章</a></li>
<li id="menu-item-2332" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2332"><a href="http://blog.fens.me/series-r-nosql/">R利剑NoSQL系列文章</a></li>
<li id="menu-item-2334" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2334"><a href="http://blog.fens.me/series-mongodb/">MongoDB部署实验系列文章</a></li>
<li id="menu-item-2335" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2335"><a href="http://blog.fens.me/series-hadoop-cloud/">让Hadoop跑在云端系列文章</a></li>
<li id="menu-item-2333" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2333"><a href="http://blog.fens.me/series-vps/">自己搭建VPS系列文章</a></li>
<li id="menu-item-5469" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-5469"><a href="http://blog.fens.me/series-architect/">架构师的信仰系列文章</a></li>
<li id="menu-item-4163" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4163"><a href="http://blog.fens.me/series-algorithm/">算法为王系列文章</a></li>
<li id="menu-item-8189" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8189"><a href="http://blog.fens.me/series-seo/">我的博客我的SEO系列文章</a></li>
<li id="menu-item-2340" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2340"><a href="http://blog.fens.me/series-visualisation/">创造可视化系列文章</a></li>
<li id="menu-item-7694" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7694"><a href="http://blog.fens.me/series-startup/">创业者的囧境系列文章</a></li>
<li id="menu-item-8842" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8842"><a href="http://blog.fens.me/tasks/">写作计划列表</a></li>
<li id="menu-item-2342" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2342"><a href="http://blog.fens.me/about/">关于站长</a></li>
<li id="menu-item-8175" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8175"><a href="http://blog.fens.me/ad/">投放广告</a></li>
</ul></div></li><li id="widget_recent_comments" class="widget png_scale"><h2 class="blocktitle"><span>最新评论</span></h2><ul id="recentcomments"><li class="recentcomments"><span class="comment-author-link">Rachel Wijaya</span> on <a href="http://blog.fens.me/hexo-blog-github/#comment-5579">Hexo在github上构建免费的Web应用</a></li><li class="recentcomments"><span class="comment-author-link">Vincent</span> on <a href="http://blog.fens.me/hadoop-mapreduce-matrix/#comment-5576">用MapReduce实现矩阵乘法</a></li><li class="recentcomments"><span class="comment-author-link"><a href='http://www.flyfishonline.com/' rel='external nofollow' class='url'>BabyGo</a></span> on <a href="http://blog.fens.me/r-docker/#comment-5572">当R语言遇上Docker</a></li><li class="recentcomments"><span class="comment-author-link">xp Wan</span> on <a href="http://blog.fens.me/linux-mysql-install/#comment-5571">在Ubuntu中安装MySQL</a></li><li class="recentcomments"><span class="comment-author-link">Kang Ji</span> on <a href="http://blog.fens.me/finance-pairs-trading/#comment-5566">R语言构建配对交易量化模型</a></li><li class="recentcomments"><span class="comment-author-link"><a href='http://blog.fens.me/' rel='external nofollow' class='url'>Conan Zhang</a></span> on <a href="http://blog.fens.me/finance-pairs-trading/#comment-5565">R语言构建配对交易量化模型</a></li><li class="recentcomments"><span class="comment-author-link">唐國淯</span> on <a href="http://blog.fens.me/finance-pairs-trading/#comment-5559">R语言构建配对交易量化模型</a></li><li class="recentcomments"><span class="comment-author-link"><a href='http://blog.fens.me/architect-next/' rel='external nofollow' class='url'>技术大牛如何寻找下一个风口 | 粉丝日志</a></span> on <a href="http://blog.fens.me/series-architect/#comment-5534">架构师的信仰系列文章</a></li><li class="recentcomments"><span class="comment-author-link">杨俊林</span> on <a href="http://blog.fens.me/nodejs-email-nodemailer/#comment-5526">Nodejs发邮件组件Nodemailer</a></li><li class="recentcomments"><span class="comment-author-link"><a href='http://blog.fens.me/' rel='external nofollow' class='url'>Conan Zhang</a></span> on <a href="http://blog.fens.me/nodejs-core-domain/#comment-5520">Nodejs异步异常处理domain</a></li><li class="recentcomments"><span class="comment-author-link">Sam Hu</span> on <a href="http://blog.fens.me/nodejs-core-domain/#comment-5517">Nodejs异步异常处理domain</a></li><li class="recentcomments"><span class="comment-author-link"><a href='http://github.com/lgh06' rel='external nofollow' class='url'>HapLeo</a></span> on <a href="http://blog.fens.me/startup-registration/#comment-5512">新公司注册流程</a></li><li class="recentcomments"><span class="comment-author-link"><a href='http://github.com/lgh06' rel='external nofollow' class='url'>HapLeo</a></span> on <a href="http://blog.fens.me/series-it-finance/#comment-5511">用IT技术玩金融系列文章</a></li><li class="recentcomments"><span class="comment-author-link">杨镇铭</span> on <a href="http://blog.fens.me/r-multi-linear-regression/#comment-5508">R语言解读多元线性回归模型</a></li><li class="recentcomments"><span class="comment-author-link"><a href='http://blog.fens.me/' rel='external nofollow' class='url'>Conan Zhang</a></span> on <a href="http://blog.fens.me/r-apply/#comment-5507">掌握R语言中的apply函数族</a></li></ul></li>		<li id="widget_recent_entries" class="widget png_scale">		<h2 class="blocktitle"><span>最新文章</span></h2>		<ul>
					<li>
				<a href="http://blog.fens.me/architect-next/">技术大牛如何寻找下一个风口</a>
						</li>
					<li>
				<a href="http://blog.fens.me/architect-algorithm/">算法，如何改变命运</a>
						</li>
					<li>
				<a href="http://blog.fens.me/angular2-init/">Angular2新的体验</a>
						</li>
					<li>
				<a href="http://blog.fens.me/finance-capm/">R语言解读资本资产定价模型CAPM</a>
						</li>
					<li>
				<a href="http://blog.fens.me/finance-mojie/">用数据解读摩羯智投</a>
						</li>
					<li>
				<a href="http://blog.fens.me/meeting-softcon-20161210/">2016中国软件技术大会:用R语言进行投资组合管理</a>
						</li>
					<li>
				<a href="http://blog.fens.me/meeting-iais-20161125/">2016IAIS人工智能产业论坛:用R语言进行投资组合管理</a>
						</li>
					<li>
				<a href="http://blog.fens.me/meeting-cdas-20160903/">2016CDAS中国数据分析师行业峰会:如何用R语言进行量化分析</a>
						</li>
					<li>
				<a href="http://blog.fens.me/r-docker/">当R语言遇上Docker</a>
						</li>
					<li>
				<a href="http://blog.fens.me/linux-docker-install/">在Ubuntu中安装Docker</a>
						</li>
					<li>
				<a href="http://blog.fens.me/r-ar/">R语言解读自回归模型</a>
						</li>
					<li>
				<a href="http://blog.fens.me/r-quant-packages/">R语言量化投资常用包总结</a>
						</li>
					<li>
				<a href="http://blog.fens.me/r-cpp-rcpp/">R语言跨界调用C++</a>
						</li>
					<li>
				<a href="http://blog.fens.me/r-multi-linear-regression/">R语言解读多元线性回归模型</a>
						</li>
					<li>
				<a href="http://blog.fens.me/r-linear-regression/">R语言解读一元线性回归模型</a>
						</li>
					<li>
				<a href="http://blog.fens.me/r-word-jiebar/">R语言中文分词包jiebaR</a>
						</li>
					<li>
				<a href="http://blog.fens.me/meeting-hellobi-20160701/">2016天善智能交流会第22场: R语言为量化而生</a>
						</li>
					<li>
				<a href="http://blog.fens.me/r-finance/">R语言为量化而生</a>
						</li>
					<li>
				<a href="http://blog.fens.me/r-data-table/">超高性能数据处理包data.table</a>
						</li>
					<li>
				<a href="http://blog.fens.me/r-apply/">掌握R语言中的apply函数族</a>
						</li>
				</ul>
		</li>		 
</ul></div>
<div class="clear"></div>

<div id="footer">
<div class="lt">Copyright &copy; 2017 All rights reserved.</div>
<div class="rt">Designed by <img src="http://blog.fens.me/wp-content/themes/silesia/images/natty-logo.png" width="82" height="17" valign="3px" class="png" alt="NattyWP" align="middle" /></div>		
<div class="clear"></div>			
</div>
    
</div>  
<div class="clear"></div>
</div><!-- END main wrapper -->

        <script type="text/javascript">
        // <![CDATA[
        var disqus_shortname = 'bsspirit';
        (function () {
            var nodes = document.getElementsByTagName('span');
            for (var i = 0, url; i < nodes.length; i++) {
                if (nodes[i].className.indexOf('dsq-postid') != -1 && nodes[i].parentNode.tagName == 'A') {
                    nodes[i].parentNode.setAttribute('data-disqus-identifier', nodes[i].getAttribute('data-dsqidentifier'));
                    url = nodes[i].parentNode.href.split('#', 1);
                    if (url.length == 1) { url = url[0]; }
                    else { url = url[1]; }
                    nodes[i].parentNode.href = url + '#disqus_thread';
                }
            }
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
        // ]]>
        </script>
        <script type="text/javascript" src="http://www.fens.me/js/google.js"></script>
<script type="text/javascript" src="http://www.fens.me/js/baidu.js"></script><script type="text/javascript" charset="utf-8">/*<![CDATA[*/ 
    jQuery(document).ready(function() {
        jQuery(".slideshow").cycle({
          fx: "turnDown",
          timeout: 6000,
          speed: 1000,
          prev: "#left-arrow",
          next: "#right-arrow",
          pagerEvent: "click",
          pauseOnPagerHover: true,
          cleartypeNoBg: true });						
      });
      /*]]>*/</script><script type='text/javascript' src='http://blog.fens.me/wp-includes/js/comment-reply.min.js?ver=4.7.4'></script>
<script type='text/javascript' src='http://blog.fens.me/wp-includes/js/wp-embed.min.js?ver=4.7.4'></script>
 
<script type="text/javascript" src="http://www.fens.me/js/ads.js"></script>
<script type="text/javascript" src="http://www.fens.me/js/google.js"></script>
<script type="text/javascript" src="http://www.fens.me/js/baidu.js"></script>

</body>
</html>